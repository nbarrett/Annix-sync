import { MigrationInterface, QueryRunner } from 'typeorm';

export class Add5DBendRadiusData1733849000000 implements MigrationInterface {
  public async up(queryRunner: QueryRunner): Promise<void> {
    // Delete existing 5D data if it exists
    await queryRunner.query(`
      DELETE FROM "bend_center_to_face" WHERE "bendType" = '5D'
    `);

    // 22 NB sizes from 40 to 1000
    const nbSizes = [40, 50, 65, 80, 100, 125, 150, 200, 250, 300, 350, 400, 450, 500, 550, 600, 650, 700, 750, 800, 900, 1000];
    
    // Radius map (5D = 5.0 Ã— NB in mm)
    const radiusMap: Record<number, number> = {
      40: 190.5,
      50: 254,
      65: 317.5,
      80: 381,
      100: 508,
      125: 635,
      150: 762,
      200: 1016,
      250: 1270,
      300: 1524,
      350: 1778,
      400: 2032,
      450: 2286,
      500: 2540,
      550: 2794,
      600: 3048,
      650: 3302,
      700: 3556,
      750: 3810,
      800: 4064,
      900: 4572,
      1000: 5080,
    };

    // Center-to-face data for each NB size (in mm)
    // Some values are null/empty for smaller degrees with larger NB sizes
    const centerToFaceData: Record<number, (number | null)[]> = {
      40: [1.7, 3.4, 5.1, 6.8, 8.5, 10.2, 11.9, 13.6, 15.3, 17.1, 19.2, 25.7, 34.4, 38.8, 43.2, 52.3, 54.1, 55.9, 57.8, 59.6, 61.5, 71.0, 80.8, 90.9, 95.1, 99.4, 101.5, 103.7, 105.9, 108.1, 110.3, 112.6, 114.9, 117.2, 119.5, 121.8, 124.2, 126.6, 129.1, 131.5, 134.0, 136.5, 139.1, 141.7, 144.3, 146.9, 149.6, 152.4, 155.1, 157.9, 160.7, 163.6, 166.5, 169.5, 172.5, 175.6, 178.7, 181.8, 185.0, 188.3, 191.6, 195.0],
      50: [2.6, 5.1, 7.7, 10.3, 12.9, 15.5, 18.0, 20.6, 23.2, 25.8, 29.1, 38.8, 52.0, 58.7, 65.4, 79.0, 81.8, 84.6, 87.4, 90.2, 93.0, 107.4, 122.2, 137.6, 143.9, 150.3, 153.6, 156.9, 160.2, 163.5, 166.9, 170.3, 173.8, 177.3, 180.8, 184.3, 187.9, 191.6, 195.3, 199.0, 202.7, 206.6, 210.4, 214.3, 218.3, 222.3, 226.4, 230.5, 234.7, 238.9, 243.2, 247.5, 252.0, 256.4, 261.0, 265.6, 270.3, 275.1, 279.9, 284.9, 289.9, 295.0],
      65: [2.8, 5.7, 8.5, 11.3, 14.2, 17.0, 19.9, 22.7, 25.6, 28.4, 32.0, 42.8, 57.3, 64.6, 72.1, 87.1, 90.1, 93.2, 96.3, 99.4, 102.5, 118.3, 134.6, 151.5, 158.5, 165.6, 169.2, 172.8, 176.5, 180.2, 183.9, 187.6, 191.4, 195.3, 199.2, 203.1, 207.0, 211.1, 215.1, 219.2, 223.4, 227.6, 231.8, 236.1, 240.5, 244.9, 249.4, 253.9, 258.5, 263.2, 267.9, 272.7, 277.6, 282.5, 287.5, 292.6, 297.8, 303.1, 308.4, 313.8, 319.4, 325.0],
      80: [3.9, 7.8, 11.7, 15.5, 19.4, 23.3, 27.2, 31.1, 35.0, 38.9, 43.8, 58.6, 78.5, 88.5, 98.7, 119.2, 123.4, 127.6, 131.8, 136.1, 140.3, 162.0, 184.3, 207.5, 217.0, 226.7, 231.7, 236.6, 241.6, 246.7, 251.8, 256.9, 262.1, 267.4, 272.7, 278.1, 283.5, 289.0, 294.5, 300.2, 305.8, 311.6, 317.4, 323.3, 329.3, 335.3, 341.5, 347.7, 354.0, 360.4, 366.8, 373.4, 380.1, 386.8, 393.7, 400.7, 407.8, 415.0, 422.3, 429.7, 437.3, 445.0],
      100: [4.4, 8.9, 13.3, 17.7, 22.2, 26.6, 31.1, 35.5, 40.0, 44.4, 50.0, 66.9, 89.6, 101.0, 112.6, 136.1, 140.9, 145.7, 150.5, 155.3, 160.2, 184.9, 210.4, 236.9, 247.8, 258.8, 264.4, 270.1, 275.8, 281.6, 287.4, 293.3, 299.2, 305.2, 311.3, 317.4, 323.6, 329.9, 336.2, 342.7, 349.1, 355.7, 362.4, 369.1, 375.9, 382.8, 389.8, 396.9, 404.1, 411.4, 418.8, 426.3, 433.9, 441.6, 449.4, 457.4, 465.5, 473.7, 482.1, 490.6, 499.2, 508.0],
      125: [5.5, 11.1, 16.6, 22.2, 27.7, 33.3, 38.8, 44.4, 50.0, 55.6, 62.5, 83.6, 112.0, 126.3, 140.8, 170.1, 176.1, 182.1, 188.1, 194.1, 200.2, 231.1, 263.0, 296.1, 309.7, 323.5, 330.6, 337.6, 344.8, 352.0, 359.3, 366.6, 374.0, 381.5, 389.1, 396.8, 404.5, 412.4, 420.3, 428.3, 436.4, 444.6, 452.9, 461.4, 469.9, 478.5, 487.3, 496.1, 505.1, 514.2, 523.5, 532.8, 542.3, 552.0, 561.8, 571.8, 581.9, 592.1, 602.6, 613.2, 624.0, 635.0],
      150: [null, null, null, null, null, null, null, null, null, null, 82.7, 110.6, 148.1, 167.1, 186.2, 225.1, 233.0, 240.9, 248.8, 256.8, 264.9, 305.7, 347.9, 391.7, 409.7, 428.0, 437.3, 446.6, 456.1, 465.6, 475.2, 485.0, 494.8, 504.7, 514.8, 524.9, 535.1, 545.5, 556.0, 566.6, 577.3, 588.2, 599.2, 610.3, 621.6, 633.0, 644.6, 656.3, 668.2, 680.2, 692.4, 704.8, 717.4, 730.2, 743.2, 756.3, 769.7, 783.3, 797.1, 811.2, 825.5, 840.0],
      200: [null, null, null, null, null, null, null, null, null, null, 100.1, 133.8, 179.1, 202.1, 225.2, 272.2, 281.8, 291.3, 301.0, 310.6, 320.3, 369.8, 420.8, 473.8, 495.5, 517.7, 528.9, 540.2, 551.6, 563.2, 574.8, 586.6, 598.5, 610.5, 622.6, 634.9, 647.3, 659.8, 672.5, 685.3, 698.3, 711.4, 724.7, 738.2, 751.8, 765.6, 779.6, 793.8, 808.2, 822.7, 837.5, 852.5, 867.7, 883.2, 898.9, 914.8, 931.0, 947.4, 964.1, 981.1, 998.4, 1016.0],
      250: [null, null, null, null, null, null, null, null, null, null, 125.1, 167.2, 223.9, 252.6, 281.6, 340.3, 352.2, 364.2, 376.2, 388.3, 400.4, 462.2, 526.1, 592.2, 619.4, 647.1, 661.1, 675.3, 689.6, 704.0, 718.5, 733.2, 748.1, 763.1, 778.3, 793.6, 809.1, 824.7, 840.6, 856.6, 872.8, 889.3, 905.9, 922.7, 939.8, 957.0, 974.5, 992.2, 1010.2, 1028.4, 1046.9, 1065.7, 1084.7, 1104.0, 1123.6, 1143.5, 1163.7, 1184.3, 1205.2, 1226.4, 1248.0, 1270.0],
      300: [null, null, null, null, null, null, null, null, null, null, 150.1, 200.6, 268.7, 303.1, 337.9, 408.4, 422.6, 437.0, 451.4, 465.9, 480.5, 554.7, 631.3, 710.7, 743.3, 776.5, 793.3, 810.3, 827.5, 844.8, 862.2, 879.9, 897.7, 915.7, 933.9, 952.3, 970.9, 989.7, 1008.7, 1028.0, 1047.4, 1067.1, 1087.1, 1107.3, 1127.7, 1148.4, 1169.4, 1190.7, 1212.2, 1234.1, 1256.3, 1278.8, 1301.6, 1324.8, 1348.3, 1372.2, 1396.5, 1421.2, 1446.2, 1471.7, 1497.6, 1524.0],
      350: [null, null, null, null, null, null, null, null, null, null, 175.1, 234.1, 313.5, 353.7, 394.2, 476.4, 493.1, 509.8, 526.7, 543.6, 560.6, 647.1, 736.5, 829.1, 867.2, 905.9, 925.6, 945.4, 965.4, 985.6, 1005.9, 1026.5, 1047.3, 1068.3, 1089.6, 1111.0, 1132.7, 1154.6, 1176.8, 1199.3, 1222.0, 1245.0, 1268.2, 1291.8, 1315.7, 1339.8, 1364.3, 1389.1, 1414.3, 1439.8, 1465.7, 1491.9, 1518.6, 1545.6, 1573.0, 1600.9, 1629.2, 1658.0, 1687.3, 1717.0, 1747.2, 1778.0],
      400: [null, null, null, null, null, null, null, null, null, null, 200.1, 267.5, 358.3, 404.2, 450.5, 544.5, 563.5, 582.7, 601.9, 621.2, 640.7, 739.6, 841.7, 947.5, 991.1, 1035.4, 1057.8, 1080.4, 1103.3, 1126.4, 1149.7, 1173.2, 1196.9, 1220.9, 1245.2, 1269.7, 1294.5, 1319.6, 1345.0, 1370.6, 1396.6, 1422.8, 1449.4, 1476.3, 1503.6, 1531.2, 1559.2, 1587.6, 1616.3, 1645.5, 1675.1, 1705.1, 1735.5, 1766.4, 1797.8, 1829.6, 1862.0, 1894.9, 1928.3, 1962.3, 1996.8, 2032.0],
      450: [null, null, null, null, null, null, null, null, null, null, 225.2, 301.0, 403.1, 454.7, 506.8, 612.5, 634.0, 655.5, 677.1, 698.9, 720.8, 832.0, 946.9, 1066.0, 1115.0, 1164.8, 1190.0, 1215.5, 1241.2, 1267.2, 1293.4, 1319.8, 1346.6, 1373.6, 1400.9, 1428.5, 1456.3, 1484.5, 1513.1, 1541.9, 1571.1, 1600.7, 1630.6, 1660.9, 1691.6, 1722.6, 1754.1, 1786.0, 1818.4, 1851.2, 1884.4, 1918.2, 1952.4, 1987.2, 2022.5, 2058.3, 2094.7, 2131.7, 2169.3, 2207.6, 2246.4, 2286.0],
      500: [null, null, null, null, null, null, null, null, null, null, 250.2, 334.4, 447.9, 505.2, 563.1, 680.6, 704.4, 728.3, 752.4, 776.6, 800.9, 924.5, 1052.1, 1184.4, 1238.8, 1294.2, 1322.2, 1350.5, 1379.1, 1407.9, 1437.1, 1466.5, 1496.2, 1526.2, 1556.5, 1587.2, 1618.2, 1649.5, 1681.2, 1713.3, 1745.7, 1778.5, 1811.8, 1845.4, 1879.5, 1914.0, 1949.0, 1984.5, 2020.4, 2056.9, 2093.8, 2131.3, 2169.4, 2208.0, 2247.2, 2287.0, 2327.5, 2368.6, 2410.4, 2452.8, 2496.1, 2540.0],
      550: [null, null, null, null, null, null, null, null, null, null, 275.2, 367.8, 492.7, 555.8, 619.4, 748.7, 774.8, 801.2, 827.6, 854.2, 880.9, 1016.9, 1157.3, 1302.9, 1362.7, 1423.6, 1454.5, 1485.6, 1517.0, 1548.7, 1580.8, 1613.1, 1645.8, 1678.8, 1712.2, 1745.9, 1780.0, 1814.4, 1849.3, 1884.6, 1920.3, 1956.4, 1992.9, 2030.0, 2067.5, 2105.4, 2143.9, 2182.9, 2222.4, 2262.5, 2303.2, 2344.4, 2386.3, 2428.8, 2471.9, 2515.7, 2560.2, 2605.4, 2651.4, 2698.1, 2745.7, 2794.0],
      600: [null, null, null, null, null, null, null, null, null, null, 300.2, 401.3, 537.4, 606.3, 675.7, 816.7, 845.3, 874.0, 902.9, 931.9, 961.0, 1109.4, 1262.5, 1421.3, 1486.6, 1553.0, 1586.7, 1620.7, 1654.9, 1689.5, 1724.5, 1759.8, 1795.4, 1831.4, 1867.8, 1904.6, 1941.8, 1979.4, 2017.4, 2055.9, 2094.8, 2134.2, 2174.1, 2214.5, 2255.4, 2296.8, 2338.8, 2381.4, 2424.5, 2468.2, 2512.6, 2557.6, 2603.2, 2649.6, 2696.6, 2744.4, 2793.0, 2842.3, 2892.4, 2943.4, 2995.3, 3048.0],
      650: [null, null, null, null, null, null, null, null, null, null, 325.2, 434.7, 582.2, 656.8, 732.0, 884.8, 915.7, 946.8, 978.1, 1009.5, 1041.1, 1201.8, 1367.7, 1539.7, 1610.5, 1682.5, 1718.9, 1755.7, 1792.8, 1830.3, 1868.2, 1906.4, 1945.0, 1984.0, 2023.5, 2063.3, 2103.6, 2144.3, 2185.5, 2227.2, 2269.4, 2312.1, 2355.3, 2399.0, 2443.4, 2488.2, 2533.7, 2579.8, 2626.5, 2673.9, 2722.0, 2770.7, 2820.2, 2870.4, 2921.4, 2973.1, 3025.7, 3079.2, 3133.5, 3188.7, 3244.9, 3302.0],
      700: [null, null, null, null, null, null, null, null, null, null, 350.2, 468.2, 627.0, 707.3, 788.3, 952.8, 986.2, 1019.7, 1053.3, 1087.2, 1121.2, 1294.3, 1472.9, 1658.2, 1734.4, 1811.9, 1851.1, 1890.8, 1930.8, 1971.1, 2011.9, 2053.1, 2094.6, 2136.7, 2179.1, 2222.0, 2265.4, 2309.3, 2353.7, 2398.6, 2444.0, 2489.9, 2536.5, 2583.6, 2631.3, 2679.6, 2728.6, 2778.3, 2828.6, 2879.6, 2931.3, 2983.8, 3037.1, 3091.2, 3146.1, 3201.8, 3258.5, 3316.0, 3374.5, 3434.0, 3494.5, 3556.0],
      750: [null, null, null, null, null, null, null, null, null, null, 375.3, 501.6, 671.8, 757.9, 844.7, 1020.9, 1056.6, 1092.5, 1128.6, 1164.8, 1201.3, 1386.7, 1578.2, 1776.6, 1858.3, 1941.3, 1983.4, 2025.8, 2068.7, 2111.9, 2155.6, 2199.7, 2244.3, 2289.3, 2334.8, 2380.8, 2427.2, 2474.2, 2521.8, 2569.9, 2618.5, 2667.8, 2717.6, 2768.1, 2819.3, 2871.0, 2923.5, 2976.7, 3030.6, 3085.3, 3140.7, 3197.0, 3254.0, 3312.0, 3370.8, 3430.5, 3491.2, 3552.9, 3615.6, 3679.3, 3744.1, 3810.0],
      800: [null, null, null, null, null, null, null, null, null, null, 400.3, 535.0, 716.6, 808.4, 901.0, 1088.9, 1127.0, 1165.3, 1203.8, 1242.5, 1281.4, 1479.2, 1683.4, 1895.1, 1982.1, 2070.7, 2115.6, 2160.9, 2206.6, 2252.7, 2299.3, 2346.4, 2393.9, 2441.9, 2490.4, 2539.5, 2589.1, 2639.2, 2689.9, 2741.2, 2793.1, 2845.6, 2898.8, 2952.7, 3007.2, 3062.4, 3118.4, 3175.1, 3232.7, 3291.0, 3350.1, 3410.1, 3471.0, 3532.8, 3595.5, 3659.2, 3724.0, 3789.7, 3856.6, 3924.6, 3993.7, 4064.0],
      900: [null, null, null, null, null, null, null, null, null, null, 450.3, 601.9, 806.2, 909.4, 1013.6, 1225.1, 1267.9, 1311.0, 1354.3, 1397.8, 1441.5, 1664.1, 1893.8, 2132.0, 2229.9, 2329.6, 2380.0, 2431.0, 2482.4, 2534.3, 2586.7, 2639.6, 2693.1, 2747.1, 2801.7, 2856.9, 2912.7, 2969.1, 3026.1, 3083.9, 3142.2, 3201.3, 3261.2, 3321.8, 3383.1, 3445.2, 3508.2, 3572.0, 3636.7, 3702.3, 3768.9, 3836.4, 3904.9, 3974.4, 4045.0, 4116.6, 4189.5, 4263.5, 4338.7, 4415.1, 4492.9, 4572.0],
      1000: [null, null, null, null, null, null, null, null, null, null, 500.3, 668.8, 895.7, 1010.5, 1126.2, 1361.2, 1408.8, 1456.7, 1504.8, 1553.1, 1601.7, 1849.0, 2104.2, 2368.8, 2477.7, 2588.4, 2644.5, 2701.1, 2758.2, 2815.9, 2874.1, 2932.9, 2992.3, 3052.4, 3113.0, 3174.3, 3236.3, 3299.0, 3362.4, 3426.5, 3491.4, 3557.1, 3623.5, 3690.8, 3759.0, 3828.1, 3898.0, 3968.9, 4040.8, 4113.7, 4187.6, 4262.6, 4338.7, 4416.0, 4494.4, 4574.1, 4655.0, 4737.2, 4820.7, 4905.7, 4992.1, 5080.0],
    };

    // Degree options (62 options)
    const degrees = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11.25, 15, 20, 22.5, 25, 30, 31, 32, 33, 34, 35, 40, 45, 50, 52, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90];

    // Generate insert records
    const records: Array<{
      bendType: string;
      nominalBoreMm: number;
      degrees: number;
      centerToFaceMm: number;
      radiusMm: number;
      radians: number;
    }> = [];

    nbSizes.forEach((nb) => {
      const radius = radiusMap[nb];
      const centerToFaceArray = centerToFaceData[nb];

      degrees.forEach((deg, index) => {
        const centerToFace = centerToFaceArray[index];
        
        // Skip if centerToFace is null (empty cell in the table)
        if (centerToFace === null) {
          return;
        }

        const radians = (deg * Math.PI) / 180;

        records.push({
          bendType: '5D',
          nominalBoreMm: nb,
          degrees: deg,
          centerToFaceMm: centerToFace,
          radiusMm: radius,
          radians: parseFloat(radians.toFixed(4)),
        });
      });
    });

    // Insert in batches to avoid query length limits
    const batchSize = 500;
    for (let i = 0; i < records.length; i += batchSize) {
      const batch = records.slice(i, i + batchSize);
      const values = batch
        .map(
          (r) =>
            `('${r.bendType}', ${r.nominalBoreMm}, ${r.degrees}, ${r.centerToFaceMm}, ${r.radiusMm}, ${r.radians})`,
        )
        .join(',\n');

      await queryRunner.query(`
        INSERT INTO "bend_center_to_face" 
        ("bendType", "nominalBoreMm", "degrees", "centerToFaceMm", "radiusMm", "radians") 
        VALUES ${values}
      `);
    }
  }

  public async down(queryRunner: QueryRunner): Promise<void> {
    await queryRunner.query(`
      DELETE FROM "bend_center_to_face" WHERE "bendType" = '5D'
    `);
  }
}
