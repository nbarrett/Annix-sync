import { MigrationInterface, QueryRunner } from 'typeorm';

export class Add1DBendRadiusData1733846400000 implements MigrationInterface {
  name = 'Add1DBendRadiusData1733846400000';

  public async up(queryRunner: QueryRunner): Promise<void> {
    // Insert 1D bend radius data for all NB sizes and degrees
    // Based on the provided 1.5D table, 1D values are calculated as (1.5D value * 1.0 / 1.5)
    // NB options: 40, 50, 65, 80, 100, 125, 150, 200, 250, 300, 350, 400, 450, 500, 600, 700, 750, 800, 900, 1000
    // Degrees: 11.25 to 90 (59 degree options)
    
    const radiusMap = {
      40: 38.1,    // 57.15 * (1/1.5)
      50: 50.8,    // 76.2 * (1/1.5)
      65: 63.5,    // 95.25 * (1/1.5)
      80: 76.2,    // 114.3 * (1/1.5)
      100: 101.6,  // 152.4 * (1/1.5)
      125: 127.0,  // 190.5 * (1/1.5)
      150: 152.4,  // 228.6 * (1/1.5)
      200: 203.2,  // 304.8 * (1/1.5)
      250: 254.0,  // 381 * (1/1.5)
      300: 304.8,  // 457.2 * (1/1.5)
      350: 355.6,  // 533.4 * (1/1.5)
      400: 406.4,  // 609.6 * (1/1.5)
      450: 457.2,  // 685.8 * (1/1.5)
      500: 508.0,  // 762 * (1/1.5)
      600: 609.6,  // 914.4 * (1/1.5)
      700: 711.2,  // 1066.8 * (1/1.5)
      750: 762.0,  // 1143 * (1/1.5)
      800: 812.8,  // 1219.2 * (1/1.5)
      900: 914.4,  // 1371.6 * (1/1.5)
      1000: 1016.0 // 1524 * (1/1.5)
    };

    // Data from the 1.5D table provided
    const centerToFaceData = {
      40: [6, 6, 8, 9, 10, 11, 13, 14, 15, 17, 18, 19, 21, 22, 24, 25, 27, 27, 28, 29, 29, 30, 30, 31, 32, 32, 33, 34, 34, 35, 36, 36, 37, 38, 39, 39, 40, 41, 42, 42, 43, 44, 45, 46, 46, 47, 48, 49, 50, 51, 52, 52, 53, 54, 55, 56, 57.2],
      50: [8, 8, 10, 12, 13, 15, 17, 19, 20, 22, 24, 26, 28, 30, 32, 34, 36, 36, 37, 38, 39, 40, 41, 41, 42, 43, 44, 45, 46, 47, 48, 49, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 60, 61, 62, 63, 64, 65, 66, 67, 69, 70, 71, 72, 74, 75, 76.2],
      65: [10, 10, 12.5, 15, 16.25, 18.75, 21.25, 23.75, 25, 27.5, 30, 32.5, 35, 37.5, 39, 42.5, 45, 45, 46.25, 47.5, 48.75, 50, 51.25, 51.25, 52.5, 53.75, 55, 56.25, 57.5, 58.75, 60, 61.25, 61.25, 62.5, 63.75, 65, 66.25, 67.5, 68.75, 70, 71.25, 72.5, 75, 76.25, 77.5, 78.75, 80, 81.25, 82.5, 83.75, 86.25, 87.5, 88.75, 90, 92.5, 93.75, 95.3],
      80: [12, 12, 16, 18, 20, 22, 26, 28, 30, 34, 36, 38, 42, 44, 47, 50, 54, 54, 56, 58, 58, 60, 60, 62, 64, 64, 66, 68, 68, 70, 72, 72, 74, 76, 78, 78, 80, 82, 84, 84, 86, 88, 90, 92, 92, 94, 96, 98, 100, 102, 104, 104, 106, 108, 110, 112, 114.4],
      100: [16, 16, 20, 24, 26, 30, 34, 38, 40, 44, 48, 52, 56, 60, 63, 68, 72, 72, 74, 76, 78, 80, 82, 82, 84, 86, 88, 90, 92, 94, 96, 98, 98, 100, 102, 104, 106, 108, 110, 112, 114, 116, 120, 122, 124, 126, 128, 130, 132, 134, 138, 140, 142, 144, 148, 150, 152.4],
      125: [20, 20, 25, 30, 32.5, 37.5, 42.5, 47.5, 50, 55, 60, 65, 70, 75, 79, 85, 90, 90, 92.5, 95, 97.5, 100, 102.5, 102.5, 105, 107.5, 110, 112.5, 115, 117.5, 120, 122.5, 122.5, 125, 127.5, 130, 132.5, 135, 137.5, 140, 142.5, 145, 150, 152.5, 155, 157.5, 160, 162.5, 165, 167.5, 172.5, 175, 177.5, 180, 185, 187.5, 190.5],
      150: [24, 24, 32, 36, 40, 44, 52, 56, 60, 68, 72, 76, 84, 88, 95, 100, 108, 108, 112, 116, 116, 120, 120, 124, 128, 128, 132, 136, 136, 140, 144, 144, 148, 152, 156, 156, 160, 164, 168, 168, 172, 176, 180, 184, 184, 188, 192, 196, 200, 204, 208, 208, 212, 216, 220, 224, 228.8],
      200: [32, 32, 40, 48, 52, 60, 68, 76, 80, 88, 96, 104, 112, 120, 126, 136, 144, 144, 148, 152, 156, 160, 164, 164, 168, 172, 176, 180, 184, 188, 192, 196, 196, 200, 204, 208, 212, 216, 220, 226, 228, 232, 240, 244, 248, 252, 256, 260, 264, 268, 276, 280, 284, 288, 296, 300, 304.8],
      250: [40, 40, 50, 60, 65, 75, 85, 95, 100, 110, 120, 130, 140, 150, 158, 170, 180, 180, 185, 190, 195, 200, 205, 205, 210, 215, 220, 225, 230, 235, 240, 245, 245, 250, 255, 260, 265, 270, 275, 280, 285, 290, 300, 305, 310, 315, 320, 325, 330, 335, 345, 350, 355, 360, 370, 375, 381],
      300: [48, 48, 64, 72, 80, 88, 104, 112, 120, 136, 144, 152, 168, 176, 190, 200, 216, 216, 224, 232, 232, 240, 240, 248, 256, 256, 264, 272, 272, 280, 288, 288, 296, 304, 312, 312, 320, 328, 336, 338, 344, 352, 360, 368, 368, 376, 384, 392, 400, 408, 416, 416, 424, 432, 440, 448, 457.6],
      350: [53, 58, 70, 82, 94, 106, 118, 131, 143, 155, 168, 181, 194, 207, 221, 235, 249, 254, 260, 266, 272, 278, 284, 290, 296, 302, 308, 314, 321, 327, 333, 340, 346, 353, 360, 367, 374, 381, 388, 395, 402, 409, 417, 424, 432, 440, 448, 456, 464, 472, 480, 489, 498, 506, 515, 524, 533.4],
      400: [64, 64, 80, 96, 104, 120, 136, 152, 160, 176, 192, 208, 224, 240, 252, 272, 288, 288, 296, 304, 312, 320, 328, 328, 336, 344, 352, 360, 368, 376, 384, 392, 392, 400, 408, 416, 424, 432, 440, 452, 456, 464, 480, 488, 496, 504, 512, 520, 528, 536, 552, 560, 568, 576, 592, 600, 609.6],
      450: [68, 75, 90, 106, 121, 136, 152, 168, 184, 200, 216, 233, 250, 267, 284, 302, 320, 327, 335, 342, 349, 357, 365, 372, 380, 388, 396, 404, 412, 420, 429, 437, 445, 454, 463, 471, 480, 489, 498, 508, 517, 526, 536, 546, 555, 565, 576, 586, 596, 607, 618, 629, 640, 651, 662, 674, 685.8],
      500: [80, 80, 100, 120, 130, 150, 170, 190, 200, 220, 240, 260, 280, 300, 316, 340, 360, 360, 370, 380, 390, 400, 410, 410, 420, 430, 440, 450, 460, 470, 480, 490, 490, 500, 510, 520, 530, 540, 550, 564, 570, 580, 600, 610, 620, 630, 640, 650, 660, 670, 690, 700, 710, 720, 740, 750, 762],
      600: [96, 96, 128, 144, 160, 176, 208, 224, 240, 272, 288, 304, 336, 352, 380, 400, 432, 432, 448, 464, 464, 480, 480, 496, 512, 512, 528, 544, 544, 560, 576, 576, 592, 608, 624, 624, 640, 656, 672, 676, 688, 704, 720, 736, 736, 752, 768, 784, 800, 816, 832, 832, 848, 864, 880, 896, 915.2],
      700: [106, 116, 140, 164, 188, 212, 236, 262, 286, 310, 336, 362, 388, 414, 442, 470, 498, 508, 520, 532, 544, 556, 568, 580, 592, 604, 616, 628, 642, 654, 666, 680, 692, 706, 720, 734, 748, 762, 776, 790, 804, 818, 834, 848, 864, 880, 896, 912, 928, 944, 960, 978, 996, 1012, 1030, 1048, 1066.8],
      750: [117, 122, 150, 178, 198, 226, 254, 283, 303, 331, 360, 389, 418, 447, 473, 507, 537, 542, 556, 570, 584, 598, 612, 618, 632, 646, 660, 674, 689, 703, 717, 732, 738, 753, 768, 783, 798, 813, 828, 847, 858, 873, 897, 912, 928, 944, 960, 976, 992, 1008, 1032, 1049, 1066, 1082, 1107, 1124, 1143],
      800: [128, 128, 160, 192, 208, 240, 272, 304, 320, 352, 384, 416, 448, 480, 504, 544, 576, 576, 592, 608, 624, 640, 656, 656, 672, 688, 704, 720, 736, 752, 768, 784, 784, 800, 816, 832, 848, 864, 880, 904, 912, 928, 960, 976, 992, 1008, 1024, 1040, 1056, 1072, 1104, 1120, 1136, 1152, 1184, 1200, 1219.2],
      900: [136, 150, 180, 212, 242, 272, 304, 336, 368, 400, 432, 466, 500, 534, 568, 604, 640, 654, 670, 684, 698, 714, 730, 744, 760, 776, 792, 808, 824, 840, 858, 874, 890, 908, 926, 942, 960, 978, 996, 1016, 1034, 1052, 1072, 1092, 1110, 1130, 1152, 1172, 1192, 1214, 1236, 1258, 1280, 1302, 1324, 1348, 1371.6],
      1000: [160, 160, 200, 240, 260, 300, 340, 380, 400, 440, 480, 520, 560, 600, 632, 680, 720, 720, 740, 760, 780, 800, 820, 820, 840, 860, 880, 900, 920, 940, 960, 980, 980, 1000, 1020, 1040, 1060, 1080, 1100, 1128, 1140, 1160, 1200, 1220, 1240, 1260, 1280, 1300, 1320, 1340, 1380, 1400, 1420, 1440, 1480, 1500, 1524]
    };

    const degrees = [
      11.25, 12.5, 15, 17.5, 20, 22.5, 25, 27.5, 30, 32.5, 35, 37.5, 40, 42.5, 45, 47.5, 50,
      51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72,
      73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90
    ];

    // Calculate radians for each degree
    const degreesToRadians = (deg: number) => (deg * Math.PI) / 180;

    // Generate INSERT statements for 1D bend data
    // For 1D, the center-to-face values are proportionally 2/3 of 1.5D values
    const values: string[] = [];

    Object.keys(centerToFaceData).forEach((nbStr) => {
      const nb = parseInt(nbStr);
      const radius = radiusMap[nb];
      const cfValues = centerToFaceData[nb];

      degrees.forEach((deg, idx) => {
        if (idx < cfValues.length) {
          const cf1_5D = cfValues[idx];
          // For 1D: multiply by (1.0/1.5) = 2/3
          const cf1D = Math.round((cf1_5D * 2 / 3) * 100) / 100;
          const radians = Math.round(degreesToRadians(deg) * 10000) / 10000;

          values.push(
            `('1D', ${nb}, ${deg}, ${cf1D}, ${radius}, ${radians})`
          );
        }
      });
    });

    // Insert in batches to avoid query length limits
    const batchSize = 500;
    for (let i = 0; i < values.length; i += batchSize) {
      const batch = values.slice(i, i + batchSize);
      const insertQuery = `
        INSERT INTO "bend_center_to_face" 
        ("bendType", "nominalBoreMm", "degrees", "centerToFaceMm", "radiusMm", "radians") 
        VALUES ${batch.join(',\n')}
      `;
      await queryRunner.query(insertQuery);
    }
  }

  public async down(queryRunner: QueryRunner): Promise<void> {
    // Remove all 1D bend data
    await queryRunner.query(`
      DELETE FROM "bend_center_to_face" WHERE "bendType" = '1D'
    `);
  }
}
