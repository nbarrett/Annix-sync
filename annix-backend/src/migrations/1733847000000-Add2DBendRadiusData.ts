import { MigrationInterface, QueryRunner } from 'typeorm';

export class Add2DBendRadiusData1733847000000 implements MigrationInterface {
  name = 'Add2DBendRadiusData1733847000000';

  public async up(queryRunner: QueryRunner): Promise<void> {
    // Delete existing 2D bend data if it exists
    await queryRunner.query(`
      DELETE FROM "bend_center_to_face" WHERE "bendType" = '2D'
    `);

    // Insert 2D bend radius data for all NB sizes and degrees
    // 2D radius = 2.0 × Nominal Bore
    // NB options: 40, 50, 65, 80, 100, 125, 150, 200, 250, 300, 350, 400, 450, 500, 600, 700, 750, 800, 900, 1000, 1050, 1100, 1150, 1200
    
    const radiusMap = {
      40: 76.2,     // 2 × NB (40 × 2 = 80, but using standard 76.2)
      50: 101.6,    // 2 × NB
      65: 127.0,    // 2 × NB
      80: 152.4,    // 2 × NB
      100: 203.2,   // 2 × NB
      125: 254.0,   // 2 × NB
      150: 304.8,   // 2 × NB
      200: 406.4,   // 2 × NB
      250: 508.0,   // 2 × NB
      300: 609.6,   // 2 × NB
      350: 711.2,   // 2 × NB
      400: 812.8,   // 2 × NB
      450: 914.4,   // 2 × NB
      500: 1016.0,  // 2 × NB
      600: 1219.2,  // 2 × NB
      700: 1422.4,  // 2 × NB
      750: 1524.0,  // 2 × NB
      800: 1625.6,  // 2 × NB
      900: 1828.8,  // 2 × NB
      1000: 2032.0, // 2 × NB
      1050: 2133.0, // 2 × NB
      1100: 2235.0, // 2 × NB
      1150: 2336.0, // 2 × NB
      1200: 2438.0  // 2 × NB
    };

    // Center-to-Face data from the provided 2D table
    const centerToFaceData = {
      40: [1.7, 3.3, 5.0, 7.5, 10.0, 13.4, 15.2, 16.9, 20.4, 24.0, 27.7, 31.6, 35.5, 37.2, 38.8, 39.7, 40.5, 41.4, 42.2, 43.1, 44.0, 44.9, 45.8, 46.7, 47.6, 48.5, 49.5, 50.4, 51.4, 52.4, 53.4, 54.4, 55.4, 56.4, 57.4, 58.5, 59.5, 60.6, 61.7, 62.8, 63.9, 65.1, 66.2, 67.4, 68.6, 69.8, 71.1, 72.3, 73.6, 74.9, 76.2],
      50: [2.2, 4.4, 6.7, 10.0, 13.4, 17.9, 20.2, 22.5, 27.2, 32.0, 37.0, 42.1, 47.4, 49.6, 51.8, 52.9, 54.0, 55.2, 56.3, 57.5, 58.7, 59.8, 61.0, 62.3, 63.5, 64.7, 66.0, 67.2, 68.5, 69.8, 71.1, 72.5, 73.8, 75.2, 76.6, 78.0, 79.4, 80.8, 82.3, 83.8, 85.3, 86.8, 88.3, 89.9, 91.5, 93.1, 94.7, 96.4, 98.1, 99.8, 101.6],
      65: [2.8, 5.5, 8.3, 12.5, 16.7, 22.4, 25.3, 28.2, 34.0, 40.0, 46.2, 52.6, 59.2, 61.9, 64.7, 66.1, 67.5, 69.0, 70.4, 71.9, 73.3, 74.8, 76.3, 77.8, 79.4, 80.9, 82.5, 84.1, 85.7, 87.3, 88.9, 90.6, 92.3, 94.0, 95.7, 97.5, 99.2, 101.0, 102.8, 104.7, 106.6, 108.5, 110.4, 112.4, 114.4, 116.4, 118.4, 120.5, 122.6, 124.8, 127.0],
      80: [3.3, 6.7, 10.0, 15.0, 20.1, 26.9, 30.3, 33.8, 40.8, 48.1, 55.5, 63.1, 71.1, 74.3, 77.7, 79.3, 81.0, 82.7, 84.5, 86.2, 88.0, 89.8, 91.6, 93.4, 95.2, 97.1, 99.0, 100.9, 102.8, 104.7, 106.7, 108.7, 110.7, 112.8, 114.8, 116.9, 119.1, 121.2, 123.4, 125.6, 127.9, 130.2, 132.5, 134.8, 137.2, 139.6, 142.1, 144.6, 147.2, 149.8, 152.4],
      100: [4.4, 8.9, 13.3, 20.0, 26.8, 35.8, 40.4, 45.0, 54.4, 64.1, 74.0, 84.2, 94.8, 99.1, 103.5, 105.8, 108.0, 110.3, 112.6, 115.0, 117.3, 119.7, 122.1, 124.5, 127.0, 129.5, 132.0, 134.5, 137.1, 139.7, 142.3, 144.9, 147.6, 150.4, 153.1, 155.9, 158.8, 161.6, 164.5, 167.5, 170.5, 173.5, 176.6, 179.8, 183.0, 186.2, 189.5, 192.8, 196.2, 199.7, 203.2],
      125: [5.5, 11.1, 16.6, 25.0, 33.4, 44.8, 50.5, 56.3, 68.1, 80.1, 92.4, 105.2, 118.4, 123.9, 129.4, 132.2, 135.1, 137.9, 140.8, 143.7, 146.6, 149.6, 152.6, 155.7, 158.7, 161.8, 164.9, 168.1, 171.3, 174.6, 177.9, 181.2, 184.5, 188.0, 191.4, 194.9, 198.4, 202.0, 205.7, 209.4, 213.1, 216.9, 220.8, 224.7, 228.7, 232.7, 236.9, 241.0, 245.3, 249.6, 254.0],
      150: [6.7, 13.3, 20.0, 30.0, 40.1, 53.7, 60.6, 67.6, 81.7, 96.1, 110.9, 126.3, 142.1, 148.7, 155.3, 158.7, 162.1, 165.5, 169.0, 172.4, 176.0, 179.5, 183.1, 186.8, 190.5, 194.2, 197.9, 201.7, 205.6, 209.5, 213.4, 217.4, 221.5, 225.5, 229.7, 233.9, 238.1, 242.4, 246.8, 251.3, 255.8, 260.3, 265.0, 269.7, 274.4, 279.3, 284.2, 289.2, 294.3, 299.5, 304.8],
      200: [8.9, 17.7, 26.6, 40.0, 53.5, 71.7, 80.8, 90.1, 108.9, 128.1, 147.9, 168.3, 189.5, 198.2, 207.1, 211.6, 216.1, 220.7, 225.3, 229.9, 234.6, 239.4, 244.2, 249.0, 253.9, 258.9, 263.9, 269.0, 274.1, 279.3, 284.6, 289.9, 295.3, 300.7, 306.2, 311.8, 317.5, 323.3, 329.1, 335.0, 341.0, 347.1, 353.3, 359.6, 365.9, 372.4, 379.0, 385.7, 392.5, 399.4, 406.4],
      250: [11.1, 22.2, 33.3, 50.0, 66.9, 89.6, 101.0, 112.6, 136.1, 160.2, 184.9, 210.4, 236.9, 247.8, 258.8, 264.4, 270.1, 275.8, 281.6, 287.4, 293.3, 299.2, 305.2, 311.3, 317.4, 323.6, 329.9, 336.2, 342.7, 349.1, 355.7, 362.4, 369.1, 375.9, 382.8, 389.8, 396.9, 404.1, 411.4, 418.8, 426.3, 433.9, 441.6, 449.4, 457.4, 465.5, 473.7, 482.1, 490.6, 499.2, 508.0],
      300: [13.3, 26.6, 40.0, 60.0, 80.3, 107.5, 121.3, 135.1, 163.3, 192.2, 221.9, 252.5, 284.3, 297.3, 310.6, 317.3, 324.1, 331.0, 337.9, 344.9, 352.0, 359.1, 366.3, 373.6, 380.9, 388.4, 395.9, 403.5, 411.2, 419.0, 426.8, 434.8, 442.9, 451.1, 459.4, 467.8, 476.3, 484.9, 493.6, 502.5, 511.5, 520.6, 529.9, 539.3, 548.9, 558.6, 568.5, 578.5, 588.7, 599.1, 609.6],
      350: [15.5, 31.1, 46.6, 70.0, 93.6, 125.4, 141.5, 157.7, 190.6, 224.2, 258.9, 294.6, 331.6, 346.9, 362.4, 370.2, 378.2, 386.2, 394.2, 402.4, 410.6, 418.9, 427.3, 435.8, 444.4, 453.1, 461.9, 470.7, 479.7, 488.8, 498.0, 507.3, 516.7, 526.3, 535.9, 545.7, 555.7, 565.7, 575.9, 586.3, 596.8, 607.4, 618.2, 629.2, 640.4, 651.7, 663.2, 674.9, 686.8, 698.9, 711.2],
      400: [17.7, 35.5, 53.3, 80.1, 107.0, 143.3, 161.7, 180.2, 217.8, 256.3, 295.8, 336.7, 379.0, 396.4, 414.1, 423.1, 432.2, 441.3, 450.5, 459.9, 469.3, 478.8, 488.4, 498.1, 507.9, 517.8, 527.8, 538.0, 548.2, 558.6, 569.1, 579.8, 590.5, 601.4, 612.5, 623.7, 635.0, 646.5, 658.2, 670.0, 682.0, 694.2, 706.6, 719.1, 731.8, 744.8, 757.9, 771.3, 784.9, 798.7, 812.8],
      450: [20.0, 39.9, 59.9, 90.1, 120.4, 161.2, 181.9, 202.7, 245.0, 288.3, 332.8, 378.8, 426.4, 446.0, 465.9, 476.0, 486.2, 496.5, 506.9, 517.3, 527.9, 538.6, 549.4, 560.3, 571.4, 582.5, 593.8, 605.2, 616.8, 628.4, 640.3, 652.2, 664.4, 676.6, 689.0, 701.6, 714.4, 727.3, 740.5, 753.8, 767.3, 781.0, 794.9, 809.0, 823.3, 837.9, 852.7, 867.7, 883.0, 898.6, 914.4],
      500: [22.2, 44.4, 66.6, 100.1, 133.8, 179.1, 202.1, 225.2, 272.2, 320.3, 369.8, 420.8, 473.8, 495.5, 517.7, 528.9, 540.2, 551.6, 563.2, 574.8, 586.6, 598.5, 610.5, 622.6, 634.9, 647.3, 659.8, 672.5, 685.3, 698.3, 711.4, 724.7, 738.2, 751.8, 765.6, 779.6, 793.8, 808.2, 822.7, 837.5, 852.5, 867.7, 883.2, 898.9, 914.8, 931.0, 947.4, 964.1, 981.1, 998.4, 1016.0],
      600: [26.6, 53.2, 79.9, 120.1, 160.5, 215.0, 242.5, 270.3, 326.7, 384.4, 443.8, 505.0, 568.5, 594.6, 621.2, 634.7, 648.3, 662.0, 675.8, 689.8, 703.9, 718.2, 732.6, 747.1, 761.8, 776.7, 791.8, 807.0, 822.4, 837.9, 853.7, 869.6, 885.8, 902.2, 918.7, 935.5, 952.5, 969.8, 987.3, 1005.0, 1023.0, 1041.3, 1059.8, 1078.7, 1097.8, 1117.2, 1136.9, 1157.0, 1177.4, 1198.1, 1219.2],
      700: [31.0, 62.1, 93.2, 140.1, 187.3, 250.8, 282.9, 315.3, 381.1, 448.5, 517.7, 589.2, 663.3, 693.8, 724.7, 740.5, 756.3, 772.3, 788.4, 804.8, 821.2, 837.9, 854.7, 871.6, 888.8, 906.2, 923.7, 941.5, 959.4, 977.6, 996.0, 1014.6, 1033.4, 1052.5, 1071.9, 1091.4, 1111.3, 1131.4, 1151.8, 1172.5, 1193.5, 1214.8, 1236.5, 1258.4, 1280.7, 1303.4, 1326.4, 1349.8, 1373.6, 1397.8, 1422.4],
      750: [33.3, 66.5, 99.9, 150.1, 200.6, 268.7, 303.1, 337.9, 408.4, 480.5, 554.7, 631.3, 710.7, 743.3, 776.5, 793.3, 810.3, 827.5, 844.8, 862.2, 879.9, 897.7, 915.7, 933.9, 952.3, 970.9, 989.7, 1008.7, 1028.0, 1047.4, 1067.1, 1087.1, 1107.3, 1127.7, 1148.4, 1169.4, 1190.7, 1212.2, 1234.1, 1256.3, 1278.8, 1301.6, 1324.8, 1348.3, 1372.2, 1396.5, 1421.2, 1446.2, 1471.7, 1497.6, 1524.0],
      800: [35.5, 71.0, 106.5, 160.1, 214.0, 286.6, 323.4, 360.4, 435.6, 512.5, 591.7, 673.3, 758.0, 792.9, 828.3, 846.2, 864.3, 882.6, 901.1, 919.7, 938.5, 957.6, 976.8, 996.2, 1015.8, 1035.6, 1055.7, 1076.0, 1096.5, 1117.2, 1138.3, 1159.5, 1181.1, 1202.9, 1225.0, 1247.4, 1270.1, 1293.1, 1316.4, 1340.0, 1364.0, 1388.4, 1413.1, 1438.2, 1463.7, 1489.6, 1515.9, 1542.6, 1569.8, 1597.5, 1625.6],
      900: [39.9, 79.8, 119.9, 180.1, 240.8, 322.5, 363.8, 405.4, 490.0, 576.6, 665.6, 757.5, 852.8, 892.0, 931.8, 952.0, 972.4, 993.0, 1013.7, 1034.7, 1055.9, 1077.2, 1098.9, 1120.7, 1142.8, 1165.1, 1187.6, 1210.5, 1233.5, 1256.9, 1280.5, 1304.5, 1328.7, 1353.2, 1378.1, 1403.3, 1428.8, 1454.7, 1480.9, 1507.5, 1534.5, 1561.9, 1589.8, 1618.0, 1646.7, 1675.8, 1705.4, 1735.5, 1766.1, 1797.2, 1828.8],
      1000: [44.3, 88.7, 133.2, 200.1, 267.5, 358.3, 404.2, 450.5, 544.5, 640.7, 739.6, 841.7, 947.5, 991.1, 1035.4, 1057.8, 1080.4, 1103.3, 1126.4, 1149.7, 1173.2, 1196.9, 1220.9, 1245.2, 1269.7, 1294.5, 1319.6, 1345.0, 1370.6, 1396.6, 1422.8, 1449.4, 1476.3, 1503.6, 1531.2, 1559.2, 1587.6, 1616.3, 1645.5, 1675.1, 1705.1, 1735.5, 1766.4, 1797.8, 1829.6, 1862.0, 1894.9, 1928.3, 1962.3, 1996.8, 2032.0],
      1050: [46.5, 93.1, 139.8, 210.1, 280.8, 376.1, 424.3, 472.9, 571.5, 672.5, 776.3, 883.5, 994.6, 1040.3, 1086.8, 1110.4, 1134.1, 1158.1, 1182.3, 1206.8, 1231.5, 1256.4, 1281.6, 1307.1, 1332.8, 1358.9, 1385.2, 1411.8, 1438.7, 1466.0, 1493.5, 1521.5, 1549.7, 1578.3, 1607.3, 1636.7, 1666.5, 1696.7, 1727.3, 1758.3, 1789.8, 1821.8, 1854.2, 1887.1, 1920.6, 1954.5, 1989.1, 2024.1, 2059.8, 2096.1, 2133.0],
      1100: [48.8, 97.6, 146.5, 220.1, 294.2, 394.1, 444.6, 495.5, 598.9, 704.7, 813.5, 925.8, 1042.2, 1090.1, 1138.8, 1163.5, 1188.4, 1213.5, 1238.9, 1264.5, 1290.4, 1316.5, 1342.9, 1369.6, 1396.6, 1423.9, 1451.4, 1479.3, 1507.5, 1536.1, 1565.0, 1594.2, 1623.8, 1653.8, 1684.2, 1715.0, 1746.2, 1777.8, 1809.9, 1842.4, 1875.4, 1908.9, 1942.9, 1977.4, 2012.4, 2048.0, 2084.2, 2120.9, 2158.3, 2196.3, 2235.0],
      1150: [51.0, 102.0, 153.1, 230.1, 307.5, 411.9, 464.7, 517.9, 625.9, 736.5, 850.2, 967.6, 1089.3, 1139.3, 1190.3, 1216.0, 1242.1, 1268.3, 1294.9, 1321.6, 1348.7, 1376.0, 1403.6, 1431.5, 1459.7, 1488.2, 1517.0, 1546.2, 1575.7, 1605.5, 1635.7, 1666.3, 1697.2, 1728.5, 1760.3, 1792.5, 1825.1, 1858.1, 1891.7, 1925.6, 1960.1, 1995.1, 2030.7, 2066.7, 2103.3, 2140.5, 2178.4, 2216.8, 2255.8, 2295.6, 2336.0],
      1200: [53.2, 106.4, 159.8, 240.1, 321.0, 429.9, 484.9, 540.5, 653.3, 768.7, 887.4, 1009.9, 1136.9, 1189.1, 1242.2, 1269.1, 1296.3, 1323.7, 1351.4, 1379.4, 1407.6, 1436.1, 1464.9, 1494.0, 1523.4, 1553.2, 1583.3, 1613.7, 1644.5, 1675.6, 1707.1, 1739.0, 1771.3, 1804.0, 1837.2, 1870.7, 1904.8, 1939.3, 1974.3, 2009.7, 2045.7, 2082.2, 2119.3, 2157.0, 2195.2, 2234.0, 2273.5, 2313.6, 2354.3, 2395.8, 2438.0]
    };

    const degrees = [
      2.5, 5, 7.5, 11.25, 15, 20, 22.5, 25, 30, 35, 40, 45, 50, 52, 54, 55, 56, 57, 58, 59, 60,
      61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82,
      83, 84, 85, 86, 87, 88, 89, 90
    ];

    // Calculate radians for each degree
    const degreesToRadians = (deg: number) => (deg * Math.PI) / 180;

    // Generate INSERT statements for 2D bend data
    const values: string[] = [];

    Object.keys(centerToFaceData).forEach((nbStr) => {
      const nb = parseInt(nbStr);
      const radius = radiusMap[nb];
      const cfValues = centerToFaceData[nb];

      degrees.forEach((deg, idx) => {
        if (idx < cfValues.length) {
          const cf2D = cfValues[idx];
          const radians = Math.round(degreesToRadians(deg) * 10000) / 10000;
          
          values.push(
            `('2D', ${nb}, ${deg}, ${cf2D}, ${radius}, ${radians})`
          );
        }
      });
    });

    // Insert in batches to avoid query length limits
    const batchSize = 500;
    for (let i = 0; i < values.length; i += batchSize) {
      const batch = values.slice(i, i + batchSize);
      const insertQuery = `
        INSERT INTO "bend_center_to_face" 
        ("bendType", "nominalBoreMm", "degrees", "centerToFaceMm", "radiusMm", "radians") 
        VALUES ${batch.join(',\n')}
      `;
      await queryRunner.query(insertQuery);
    }
  }

  public async down(queryRunner: QueryRunner): Promise<void> {
    // Remove all 2D bend data
    await queryRunner.query(`
      DELETE FROM "bend_center_to_face" WHERE "bendType" = '2D'
    `);
  }
}
